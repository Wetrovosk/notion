<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glucose Tracker - All Entries</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h1 class="text-center">All Tracking Entries</h1>
                    <p class="text-center mb-0">View your complete food, water, and glucose history</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Filter Entries</h5>
                        <div class="row">
                            <div class="col-md-3">
                                <label for="filterStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="filterStartDate">
                            </div>
                            <div class="col-md-3">
                                <label for="filterEndDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="filterEndDate">
                            </div>
                            <div class="col-md-3">
                                <label for="entryType" class="form-label">Entry Type</label>
                                <select class="form-select" id="entryType">
                                    <option value="">All Types</option>
                                    <option value="food">Food</option>
                                    <option value="water">Water</option>
                                    <option value="glucose">Glucose</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">&nbsp;</label>
                                <div>
                                    <button class="btn btn-primary w-100" id="applyFilters">Apply Filters</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card entry-table">
                    <div class="card-body">
                        <h5 class="card-title">Entries Table</h5>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Date/Time</th>
                                        <th>Type</th>
                                        <th>Details</th>
                                        <th>Macros/Notes</th>
                                    </tr>
                                </thead>
                                <tbody id="entriesTableBody">
                                    <!-- Entries will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div id="loadingSpinner" class="d-none text-center my-4">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <div id="noEntriesMessage" class="d-none text-center my-4 text-muted">
                            No entries found
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date range to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('filterStartDate').value = today;
            document.getElementById('filterEndDate').value = today;
            
            loadEntries();
        });

        function loadEntries() {
            const startDate = document.getElementById('filterStartDate').value;
            const endDate = document.getElementById('filterEndDate').value;
            const entryType = document.getElementById('entryType').value;
            
            // Show loading spinner
            document.getElementById('loadingSpinner').classList.remove('d-none');
            document.getElementById('entriesTableBody').innerHTML = '';
            document.getElementById('noEntriesMessage').classList.add('d-none');
            
            let url = '/api/tracking-entries';
            const params = [];
            
            if (startDate && endDate) {
                params.push(`startDate=${startDate}T00:00:00`);
                params.push(`endDate=${endDate}T23:59:59`);
            }
            
            if (entryType) {
                params.push(`type=${entryType}`);
            }
            
            if (params.length > 0) {
                url += '?' + params.join('&');
            }
            
            fetch(url)
            .then(response => response.json())
            .then(entries => {
                displayEntries(entries);
                document.getElementById('loadingSpinner').classList.add('d-none');
            })
            .catch(error => {
                console.error('Error loading entries:', error);
                document.getElementById('loadingSpinner').classList.add('d-none');
                document.getElementById('noEntriesMessage').classList.remove('d-none');
            });
        }

        function displayEntries(entries) {
            const tbody = document.getElementById('entriesTableBody');
            
            if (entries.length === 0) {
                document.getElementById('noEntriesMessage').classList.remove('d-none');
                return;
            }
            
            document.getElementById('noEntriesMessage').classList.add('d-none');
            
            tbody.innerHTML = '';
            
            entries.forEach(entry => {
                const row = document.createElement('tr');
                row.classList.add('fade-in-row');
                
                // Add class based on entry type
                switch(entry.entry_type) {
                    case 'food':
                        row.classList.add('food-row');
                        break;
                    case 'water':
                        row.classList.add('water-row');
                        break;
                    case 'glucose':
                        row.classList.add('glucose-row');
                        break;
                }
                
                // Format timestamp
                const date = new Date(entry.timestamp);
                const formattedTime = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const formattedDate = date.toLocaleDateString();
                
                // Create cells
                const dateCell = document.createElement('td');
                dateCell.textContent = `${formattedDate}\n${formattedTime}`;
                dateCell.style.whiteSpace = 'pre';
                
                const typeCell = document.createElement('td');
                if(entry.entry_type === 'food') {
                    typeCell.innerHTML = `<strong>üçΩ ${entry.entry_type.charAt(0).toUpperCase() + entry.entry_type.slice(1)}</strong>`;
                } else if(entry.entry_type === 'water') {
                    typeCell.innerHTML = `<strong>üíß ${entry.entry_type.charAt(0).toUpperCase() + entry.entry_type.slice(1)}</strong>`;
                } else {
                    typeCell.innerHTML = `<strong>üìä ${entry.entry_type.charAt(0).toUpperCase() + entry.entry_type.slice(1)}</strong>`;
                }
                
                const detailsCell = document.createElement('td');
                if (entry.meal_name) {
                    detailsCell.innerHTML = `<strong>${entry.meal_name}</strong>`;
                    if (entry.description) {
                        detailsCell.innerHTML += `<br><small class="text-muted">${entry.description}</small>`;
                    }
                } else if (entry.amount_ml) {
                    detailsCell.textContent = `${entry.amount_ml} ml of water`;
                } else if (entry.glucose_reading) {
                    detailsCell.innerHTML = `Glucose: <strong>${entry.glucose_reading} –º–º–æ–ª—å/–ª</strong>`;
                }
                
                const macrosCell = document.createElement('td');
                const macros = [];
                
                if (entry.carbs) macros.push(`Carbs: ${entry.carbs}g`);
                if (entry.protein) macros.push(`Protein: ${entry.protein}g`);
                if (entry.fat) macros.push(`Fat: ${entry.fat}g`);
                if (entry.calories) macros.push(`Calories: ${entry.calories}`);
                if (entry.notes) macros.push(`Notes: ${entry.notes}`);
                
                macrosCell.innerHTML = macros.join('<br>');
                
                row.appendChild(dateCell);
                row.appendChild(typeCell);
                row.appendChild(detailsCell);
                row.appendChild(macrosCell);
                
                tbody.appendChild(row);
            });
        }

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>